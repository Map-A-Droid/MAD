{% extends "base.html" %}

{% block header %}
{% endblock %}

{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.lazyload/1.9.1/jquery.lazyload.js"></script>
<script type="text/javascript" src="static/js/jquery.Aplus.min.js"></script>

<script>
    function setGrid(tableGridHtmlId, gridData) {
        $(tableGridHtmlId).DataTable({
            "data": gridData,
            "columns": [
                { data: 'filename', title: 'Filename' },
                { data: 'creation', title: 'Added' },
                { data: '', title: '' }
            ],
            "columnDefs": [
                {
                    "targets": [2],
                    "render": function (data, type, row) {
                        {% if origin %}
                            var link = "<center><a href='install_file?filename=" + row.filename + "&origin={{origin}}&adb={{adb}}' class='confirm' title='Do you really want to install this file?'><img src='static/install.png' width='30'></a></center>";
                        {% else %}
                            var link = "<center><a href='delete_file?filename=" + row.filename + "' class='confirm' title='Do you really want to delete this file?'><img src='static/delete.png' width='30'></a> - <a href='install_file_all_devices?filename=" + row.filename + "' class='confirm' title='Do you really want to install this file on all devices?'><img src='static/install_all.png' width='30'></a></center>";
                        {% endif %}
                        return link;
                    }
                }
            ],
            "order": [[1, "desc"]],
            "responsive": {{ responsive }},
        });
	}

    $(document).ready(function () {
        $('body').Aplus();
        $("#navgyms").addClass("active");
        $.ajax({
            type: "GET",
            url: "get_uploaded_files",
            success: function (result) {
                setGrid('#show-data', result);
            }
        });
    });
</script>
{% endblock %}

{% block content %}
<h2>Uploaded Files</h2>
<p>
	{% with messages = get_flashed_messages() %}
	  {% if messages %}
		{% for message in messages %}
		  <div class="p-3 mb-2 bg-secondary text-white">{{ message }}</div>
		{% endfor %}
	  {% endif %}
	{% endwith %}
</p>
<table id="show-data" class="table" style="width:100%;"></table>
{% endblock %}
